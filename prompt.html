<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <style>
        .optionsDiv {
            display: flex;
            margin: 10px;
            justify-content: space-between;
            max-width: 500px;
        }
    </style>
</head>
<body>
    <div>
        <div id="myForm">
            <form id="form">
            </form>
            <div id="errOut"></div>
        </div>
    </div>
</body>

<script>
    console.log("Retrieving data from apps script...")
    const data = JSON.parse(<?= JSON.stringify(data) ?>)



    function setup() {
        function createOptions(id, text, data) {
            const div = document.createElement("div");
            const label = document.createElement("label");
            label.for = id;
            label.textContent = text

            const select = document.createElement("select");
            select.name = id;
            select.id = id;

            for (const item of data) {
                const option = document.createElement("option");
                option.value = item;
                option.textContent = item;
                select.append(option)
            }

            div.append(label, select)
            div.classList.add("optionsDiv")
            return div
        }

        console.log("Parsing data...")
        const {active, colDict} = data
        console.log(colDict)

        const colSet = new Set()

        for (const key in colDict){
            colDict[key].forEach(h => colSet.add(h))
        }

        const parent = document.getElementById("form")
        parent.append(
            createOptions("order", "Bestellliste", Object.keys(colDict)),
            createOptions("inventory", "Bestandliste", Object.keys(colDict)),
            createOptions("join", "Identifier (ID/Name)", colSet),
            createOptions("current", "Ist (Bestand)", colSet),
            createOptions("target", "Soll (KapazitÃ¤t)", colSet),
            createOptions("size", "Menge (Verpackungseinheit)", colSet)
        )

        document.getElementById("inventory").value = active

        const button = document.createElement("input")
        button.type = "button"
        button.value = "Erstellen"
        button.onclick = () => {
            const get = (id) => document.getElementById(id).value

            google.script.run.withFailureHandler((e) => {
                alert(e)
                document.getElementById("errOut").textContent = e
            }).withSuccessHandler((res) => alert(res)).getAndCreate(
                get("order"), get("inventory"), get("join"), get("current"), get("target"), get("size"))
        }

        parent.append(button)
    }

    setup()
</script>
</html>